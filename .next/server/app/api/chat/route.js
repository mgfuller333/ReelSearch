"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50044:(e,t,r)=>{let a;r.r(t),r.d(t,{headerHooks:()=>rY,originalPathname:()=>r0,patchFetch:()=>r1,requestAsyncStorage:()=>rG,routeModule:()=>rK,serverHooks:()=>rW,staticGenerationAsyncStorage:()=>rX,staticGenerationBailout:()=>rQ});var n,o,s,i,l,u,c,p,m,d,f,g,h,y,b,v,w={};r.r(w),r.d(w,{POST:()=>rH});var x=r(26040),_=r(7623),k=r(52816),E=r(59152);r(42534);var I=r(37693),T=r(43268),S=class extends Error{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:n,responseBody:o,cause:s,isRetryable:i=null!=a&&(408===a||409===a||429===a||a>=500),data:l}){super(e),this.name="AI_APICallError",this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=n,this.responseBody=o,this.cause=s,this.isRetryable=i,this.data=l}static isAPICallError(e){return e instanceof Error&&"AI_APICallError"===e.name&&"string"==typeof e.url&&"object"==typeof e.requestBodyValues&&(null==e.statusCode||"number"==typeof e.statusCode)&&(null==e.responseHeaders||"object"==typeof e.responseHeaders)&&(null==e.responseBody||"string"==typeof e.responseBody)&&(null==e.cause||"object"==typeof e.cause)&&"boolean"==typeof e.isRetryable&&(null==e.data||"object"==typeof e.data)}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}},A=class extends Error{constructor({message:e="Empty response body"}={}){super(e),this.name="AI_EmptyResponseBodyError"}static isEmptyResponseBodyError(e){return e instanceof Error&&"AI_EmptyResponseBodyError"===e.name}toJSON(){return{name:this.name,message:this.message,stack:this.stack}}},j=class extends Error{constructor({prompt:e,message:t}){super(`Invalid prompt: ${t}`),this.name="AI_InvalidPromptError",this.prompt=e}static isInvalidPromptError(e){return e instanceof Error&&"AI_InvalidPromptError"===e.name&&null!=prompt}toJSON(){return{name:this.name,message:this.message,stack:this.stack,prompt:this.prompt}}},z=class extends Error{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super(t),this.name="AI_InvalidResponseDataError",this.data=e}static isInvalidResponseDataError(e){return e instanceof Error&&"AI_InvalidResponseDataError"===e.name&&null!=e.data}toJSON(){return{name:this.name,message:this.message,stack:this.stack,data:this.data}}};function N(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}var C=class extends Error{constructor({text:e,cause:t}){super(`JSON parsing failed: Text: ${e}.
Error message: ${N(t)}`),this.name="AI_JSONParseError",this.cause=t,this.text=e}static isJSONParseError(e){return e instanceof Error&&"AI_JSONParseError"===e.name&&"string"==typeof e.text&&"string"==typeof e.cause}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}},P=class extends Error{constructor({message:e}){super(e),this.name="AI_LoadAPIKeyError"}static isLoadAPIKeyError(e){return e instanceof Error&&"AI_LoadAPIKeyError"===e.name}toJSON(){return{name:this.name,message:this.message}}},O=class extends Error{constructor(e){super(`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`),this.name="AI_TooManyEmbeddingValuesForCallError",this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInvalidPromptError(e){return e instanceof Error&&"AI_TooManyEmbeddingValuesForCallError"===e.name&&"provider"in e&&"string"==typeof e.provider&&"modelId"in e&&"string"==typeof e.modelId&&"maxEmbeddingsPerCall"in e&&"number"==typeof e.maxEmbeddingsPerCall&&"values"in e&&Array.isArray(e.values)}toJSON(){return{name:this.name,message:this.message,stack:this.stack,provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:this.values}}},R=class extends Error{constructor({value:e,cause:t}){super(`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${N(t)}`),this.name="AI_TypeValidationError",this.cause=t,this.value=e}static isTypeValidationError(e){return e instanceof Error&&"AI_TypeValidationError"===e.name&&"string"==typeof e.value&&"string"==typeof e.cause}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}},$=class extends Error{constructor({functionality:e}){super(`'${e}' functionality not supported.`),this.name="AI_UnsupportedFunctionalityError",this.functionality=e}static isUnsupportedFunctionalityError(e){return e instanceof Error&&"AI_UnsupportedFunctionalityError"===e.name&&"string"==typeof e.functionality}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};let M=(e,t=21)=>(r=t)=>{let a="",n=r;for(;n--;)a+=e[Math.random()*e.length|0];return a};var U=r(16428),q=r.n(U);let L=[239,187,191];class Z extends TransformStream{constructor(){let e;super({start(t){e=function(e){let t,r,a,n,o,s,i;return l(),{feed:function(l){var u;r=r?r+l:l,t&&(u=r,L.every((e,t)=>u.charCodeAt(t)===e))&&(r=r.slice(L.length)),t=!1;let c=r.length,p=0,m=!1;for(;p<c;){let t;m&&("\n"===r[p]&&++p,m=!1);let l=-1,u=n;for(let e=a;l<0&&e<c;++e)":"===(t=r[e])&&u<0?u=e-p:"\r"===t?(m=!0,l=e-p):"\n"===t&&(l=e-p);if(l<0){a=c-p,n=u;break}a=0,n=-1,function(t,r,a,n){if(0===n){i.length>0&&(e({type:"event",id:o,event:s||void 0,data:i.slice(0,-1)}),i="",o=void 0),s=void 0;return}let l=a<0,u=t.slice(r,r+(l?n:a)),c=0;c=l?n:" "===t[r+a+1]?a+2:a+1;let p=r+c,m=n-c,d=t.slice(p,p+m).toString();if("data"===u)i+=d?"".concat(d,"\n"):"\n";else if("event"===u)s=d;else if("id"!==u||d.includes("\x00")){if("retry"===u){let t=parseInt(d,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else o=d}(r,p,u,l),p+=l+1}p===c?r="":p>0&&(r=r.slice(p))},reset:l};function l(){t=!0,r="",a=0,n=-1,o=void 0,s=void 0,i=""}}(e=>{"event"===e.type&&t.enqueue(e)})},transform(t){e.feed(t)}})}}function B(e){let t={};return e.headers.forEach((e,r)=>{t[r]=e}),t}var J=M("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function F(e){return e instanceof DOMException&&("AbortError"===e.name||"TimeoutError"===e.name)}function D({text:e,schema:t}){try{let r=q().parse(e);if(null==t)return{success:!0,value:r};return function({value:e,schema:t}){try{let r=t.safeParse(e);if(r.success)return{success:!0,value:r.data};return{success:!1,error:new R({value:e,cause:r.error})}}catch(t){return{success:!1,error:R.isTypeValidationError(t)?t:new R({value:e,cause:t})}}}({value:r,schema:t})}catch(t){return{success:!1,error:C.isJSONParseError(t)?t:new C({text:e,cause:t})}}}var V=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:n,abortSignal:o})=>H({url:e,headers:{...t,"Content-Type":"application/json"},body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:n,abortSignal:o}),H=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:n,abortSignal:o})=>{try{let s=Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),i=await fetch(e,{method:"POST",headers:s,body:r.content,signal:o}),l=B(i);if(!i.ok){let t;try{t=await n({response:i,url:e,requestBodyValues:r.values})}catch(t){if(F(t)||S.isAPICallError(t))throw t;throw new S({message:"Failed to process error response",cause:t,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw t.value}try{return await a({response:i,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(F(t)||S.isAPICallError(t)))throw t;throw new S({message:"Failed to process successful response",cause:t,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(t){if(F(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let a=t.cause;if(null!=a)throw new S({message:`Cannot connect to API: ${a.message}`,cause:a,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}},K=e=>async({response:t})=>{let r=B(t);if(null==t.body)throw new A({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new Z).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(D({text:t,schema:e}))}}))}},G=e=>async({response:t,url:r,requestBodyValues:a})=>{let n=await t.text(),o=D({text:n,schema:e}),s=B(t);if(!o.success)throw new S({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:n,url:r,requestBodyValues:a});return{responseHeaders:s,value:o.value}},X=r(44132);function W(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var Y=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:n,requestBodyValues:o})=>{let s=await a.text(),i=B(a);if(""===s.trim())return{responseHeaders:i,value:new S({message:a.statusText,url:n,requestBodyValues:o,statusCode:a.status,responseHeaders:i,responseBody:s,isRetryable:null==r?void 0:r(a)})};try{let l=function({text:e,schema:t}){try{let r=q().parse(e);if(null==t)return r;return function({value:e,schema:t}){try{return t.parse(e)}catch(t){throw new R({value:e,cause:t})}}({value:r,schema:t})}catch(t){if(C.isJSONParseError(t)||R.isTypeValidationError(t))throw t;throw new C({text:e,cause:t})}}({text:s,schema:e});return{responseHeaders:i,value:new S({message:t(l),url:n,requestBodyValues:o,statusCode:a.status,responseHeaders:i,responseBody:s,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:i,value:new S({message:a.statusText,url:n,requestBodyValues:o,statusCode:a.status,responseHeaders:i,responseBody:s,isRetryable:null==r?void 0:r(a)})}}})({errorSchema:X.z.object({error:X.z.object({message:X.z.string(),type:X.z.string(),param:X.z.any().nullable(),code:X.z.string().nullable()})}),errorToMessage:e=>e.error.message});function Q(e){var t,r;return null!=(r=null==(t=null==e?void 0:e.content)?void 0:t.map(({token:e,logprob:t,top_logprobs:r})=>({token:e,logprob:t,topLogprobs:r?r.map(({token:e,logprob:t})=>({token:e,logprob:t})):[]})))?r:void 0}var ee=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,prompt:t,maxTokens:r,temperature:a,topP:n,frequencyPenalty:o,presencePenalty:s,seed:i}){var l;let u=e.type,c={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,max_tokens:r,temperature:a,top_p:n,frequency_penalty:o,presence_penalty:s,seed:i,messages:function(e){let t=[];for(let{role:r,content:a}of e)switch(r){case"system":t.push({role:"system",content:a});break;case"user":t.push({role:"user",content:a.map(e=>{var t;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(t=e.mimeType)?t:"image/jpeg"};base64,${function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return globalThis.btoa(t)}(e.image)}`}}}})});break;case"assistant":{let e="",r=[];for(let t of a)switch(t.type){case"text":e+=t.text;break;case"tool-call":r.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}});break;default:throw Error(`Unsupported part: ${t}`)}t.push({role:"assistant",content:e,tool_calls:r.length>0?r:void 0});break}case"tool":for(let e of a)t.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result)});break;default:throw Error(`Unsupported role: ${r}`)}return t}(t)};switch(u){case"regular":{let t=(null==(l=e.tools)?void 0:l.length)?e.tools:void 0;return{...c,tools:null==t?void 0:t.map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters}}))}}case"object-json":return{...c,response_format:{type:"json_object"}};case"object-tool":return{...c,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}}]};case"object-grammar":throw new $({functionality:"object-grammar mode"});default:throw Error(`Unsupported type: ${u}`)}}async doGenerate(e){var t,r;let a=this.getArgs(e),{responseHeaders:n,value:o}=await V({url:`${this.config.baseURL}/chat/completions`,headers:this.config.headers(),body:a,failedResponseHandler:Y,successfulResponseHandler:G(et),abortSignal:e.abortSignal}),{messages:s,...i}=a,l=o.choices[0];return{text:null!=(t=l.message.content)?t:void 0,toolCalls:null==(r=l.message.tool_calls)?void 0:r.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:J(),toolName:e.function.name,args:e.function.arguments}}),finishReason:W(l.finish_reason),usage:{promptTokens:o.usage.prompt_tokens,completionTokens:o.usage.completion_tokens},rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:n},warnings:[],logprobs:Q(l.logprobs)}}async doStream(e){let t;let r=this.getArgs(e),{responseHeaders:a,value:n}=await V({url:`${this.config.baseURL}/chat/completions`,headers:this.config.headers(),body:{...r,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},failedResponseHandler:Y,successfulResponseHandler:K(er),abortSignal:e.abortSignal}),{messages:o,...s}=r,i=[],l="other",u={promptTokens:Number.NaN,completionTokens:Number.NaN};return{stream:n.pipeThrough(new TransformStream({transform(e,r){var a,n,o,s,c,p,m,d,f;if(!e.success){r.enqueue({type:"error",error:e.error});return}let g=e.value;null!=g.usage&&(u={promptTokens:g.usage.prompt_tokens,completionTokens:g.usage.completion_tokens});let h=g.choices[0];if((null==h?void 0:h.finish_reason)!=null&&(l=W(h.finish_reason)),(null==h?void 0:h.delta)==null)return;let y=h.delta;null!=y.content&&r.enqueue({type:"text-delta",textDelta:y.content});let b=Q(null==h?void 0:h.logprobs);if((null==b?void 0:b.length)&&(void 0===t&&(t=[]),t.push(...b)),null!=y.tool_calls)for(let e of y.tool_calls){let t=e.index;if(null==i[t]){if("function"!==e.type)throw new z({data:e,message:"Expected 'function' type."});if(null==e.id)throw new z({data:e,message:"Expected 'id' to be a string."});if((null==(a=e.function)?void 0:a.name)==null)throw new z({data:e,message:"Expected 'function.name' to be a string."});i[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(n=e.function.arguments)?n:""}};continue}let l=i[t];(null==(o=e.function)?void 0:o.arguments)!=null&&(l.function.arguments+=null!=(c=null==(s=e.function)?void 0:s.arguments)?c:""),r.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:l.id,toolName:l.function.name,argsTextDelta:null!=(p=e.function.arguments)?p:""}),(null==(m=l.function)?void 0:m.name)!=null&&(null==(d=l.function)?void 0:d.arguments)!=null&&function(e){try{return q().parse(e),!0}catch(e){return!1}}(l.function.arguments)&&r.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(f=l.id)?f:J(),toolName:l.function.name,args:l.function.arguments})}},flush(e){e.enqueue({type:"finish",finishReason:l,logprobs:t,usage:u})}})),rawCall:{rawPrompt:o,rawSettings:s},rawResponse:{headers:a},warnings:[]}}},et=X.z.object({choices:X.z.array(X.z.object({message:X.z.object({role:X.z.literal("assistant"),content:X.z.string().nullable().optional(),tool_calls:X.z.array(X.z.object({id:X.z.string().optional().nullable(),type:X.z.literal("function"),function:X.z.object({name:X.z.string(),arguments:X.z.string()})})).optional()}),index:X.z.number(),logprobs:X.z.object({content:X.z.array(X.z.object({token:X.z.string(),logprob:X.z.number(),top_logprobs:X.z.array(X.z.object({token:X.z.string(),logprob:X.z.number()}))})).nullable()}).nullable().optional(),finish_reason:X.z.string().optional().nullable()})),object:X.z.literal("chat.completion"),usage:X.z.object({prompt_tokens:X.z.number(),completion_tokens:X.z.number()})}),er=X.z.object({object:X.z.enum(["chat.completion.chunk","chat.completion"]),choices:X.z.array(X.z.object({delta:X.z.object({role:X.z.enum(["assistant"]).optional(),content:X.z.string().nullable().optional(),tool_calls:X.z.array(X.z.object({index:X.z.number(),id:X.z.string().optional().nullable(),type:X.z.literal("function").optional(),function:X.z.object({name:X.z.string().optional(),arguments:X.z.string().optional()})})).optional()}),logprobs:X.z.object({content:X.z.array(X.z.object({token:X.z.string(),logprob:X.z.number(),top_logprobs:X.z.array(X.z.object({token:X.z.string(),logprob:X.z.number()}))})).nullable()}).nullable().optional(),finish_reason:X.z.string().nullable().optional(),index:X.z.number()})),usage:X.z.object({prompt_tokens:X.z.number(),completion_tokens:X.z.number()}).optional().nullable()});function ea(e){return null==e?void 0:e.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([e,t])=>({token:e,logprob:t})):[]}))}var en=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:a,temperature:n,topP:o,frequencyPenalty:s,presencePenalty:i,seed:l}){var u;let c=e.type,{prompt:p,stopSequences:m}=function({prompt:e,inputFormat:t,user:r="user",assistant:a="assistant"}){if("prompt"===t&&1===e.length&&"user"===e[0].role&&1===e[0].content.length&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let n="";for(let{role:t,content:o}of("system"===e[0].role&&(n+=`${e[0].content}

`,e=e.slice(1)),e))switch(t){case"system":throw new j({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=o.map(e=>{switch(e.type){case"text":return e.text;case"image":throw new $({functionality:"images"})}}).join("");n+=`${r}:
${e}

`;break}case"assistant":{let e=o.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new $({functionality:"tool-call messages"})}}).join("");n+=`${a}:
${e}

`;break}case"tool":throw new $({functionality:"tool messages"});default:throw Error(`Unsupported role: ${t}`)}return{prompt:n+=`${a}:
`,stopSequences:[`
${r}:`]}}({prompt:r,inputFormat:t}),d={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:a,temperature:n,top_p:o,frequency_penalty:s,presence_penalty:i,seed:l,prompt:p,stop:m};switch(c){case"regular":if(null==(u=e.tools)?void 0:u.length)throw new $({functionality:"tools"});return d;case"object-json":throw new $({functionality:"object-json mode"});case"object-tool":throw new $({functionality:"object-tool mode"});case"object-grammar":throw new $({functionality:"object-grammar mode"});default:throw Error(`Unsupported type: ${c}`)}}async doGenerate(e){let t=this.getArgs(e),{responseHeaders:r,value:a}=await V({url:`${this.config.baseURL}/completions`,headers:this.config.headers(),body:t,failedResponseHandler:Y,successfulResponseHandler:G(eo),abortSignal:e.abortSignal}),{prompt:n,...o}=t,s=a.choices[0];return{text:s.text,usage:{promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens},finishReason:W(s.finish_reason),logprobs:ea(s.logprobs),rawCall:{rawPrompt:n,rawSettings:o},rawResponse:{headers:r},warnings:[]}}async doStream(e){let t;let r=this.getArgs(e),{responseHeaders:a,value:n}=await V({url:`${this.config.baseURL}/completions`,headers:this.config.headers(),body:{...this.getArgs(e),stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},failedResponseHandler:Y,successfulResponseHandler:K(es),abortSignal:e.abortSignal}),{prompt:o,...s}=r,i="other",l={promptTokens:Number.NaN,completionTokens:Number.NaN};return{stream:n.pipeThrough(new TransformStream({transform(e,r){if(!e.success){r.enqueue({type:"error",error:e.error});return}let a=e.value;null!=a.usage&&(l={promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens});let n=a.choices[0];(null==n?void 0:n.finish_reason)!=null&&(i=W(n.finish_reason)),(null==n?void 0:n.text)!=null&&r.enqueue({type:"text-delta",textDelta:n.text});let o=ea(null==n?void 0:n.logprobs);(null==o?void 0:o.length)&&(void 0===t&&(t=[]),t.push(...o))},flush(e){e.enqueue({type:"finish",finishReason:i,logprobs:t,usage:l})}})),rawCall:{rawPrompt:o,rawSettings:s},rawResponse:{headers:a},warnings:[]}}},eo=X.z.object({choices:X.z.array(X.z.object({text:X.z.string(),finish_reason:X.z.string(),logprobs:X.z.object({tokens:X.z.array(X.z.string()),token_logprobs:X.z.array(X.z.number()),top_logprobs:X.z.array(X.z.record(X.z.string(),X.z.number())).nullable()}).nullable().optional()})),usage:X.z.object({prompt_tokens:X.z.number(),completion_tokens:X.z.number()})}),es=X.z.object({object:X.z.literal("text_completion"),choices:X.z.array(X.z.object({text:X.z.string(),finish_reason:X.z.enum(["stop","length","content_filter"]).optional().nullable(),index:X.z.number(),logprobs:X.z.object({tokens:X.z.array(X.z.string()),token_logprobs:X.z.array(X.z.number()),top_logprobs:X.z.array(X.z.record(X.z.string(),X.z.number())).nullable()}).nullable().optional()})),usage:X.z.object({prompt_tokens:X.z.number(),completion_tokens:X.z.number()}).optional().nullable()}),ei=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.settings.supportsParallelCalls)||e}async doEmbed({values:e,abortSignal:t}){if(e.length>this.maxEmbeddingsPerCall)throw new O({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:r,value:a}=await V({url:`${this.config.baseURL}/embeddings`,headers:this.config.headers(),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:Y,successfulResponseHandler:G(el),abortSignal:t});return{embeddings:a.data.map(e=>e.embedding),rawResponse:{headers:r}}}},el=X.z.object({data:X.z.array(X.z.object({embedding:X.z.array(X.z.number())}))}),eu=function(e={}){var t,r,a,n;let o=null!=(r=null==(n=null!=(t=e.baseURL)?t:e.baseUrl)?void 0:n.replace(/\/$/,""))?r:"https://api.openai.com/v1",s=null!=(a=e.compatibility)?a:"compatible",i=()=>({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:a}){if("string"==typeof e)return e;if(null!=e)throw new P({message:`${a} API key must be a string.`});if("undefined"==typeof process)throw new P({message:`${a} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new P({message:`${a} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new P({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),l=(e,t={})=>new ee(e,t,{provider:"openai.chat",baseURL:o,headers:i,compatibility:s}),u=(e,t={})=>new en(e,t,{provider:"openai.completion",baseURL:o,headers:i,compatibility:s}),c=function(e,t){if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===e?u(e,t):l(e,t)};return c.chat=l,c.completion=u,c.embedding=(e,t={})=>new ei(e,t,{provider:"openai.embedding",baseURL:o,headers:i}),c}({compatibility:"strict"}),ec="vercel.ai.error",ep=Symbol.for(ec),em=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[n]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,ec)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}toJSON(){return{name:this.name,message:this.message}}};n=ep;var ed=em,ef="AI_APICallError",eg=`vercel.ai.error.${ef}`,eh=Symbol.for(eg),ey=class extends ed{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:n,responseBody:s,cause:i,isRetryable:l=null!=a&&(408===a||409===a||429===a||a>=500),data:u}){super({name:ef,message:e,cause:i}),this[o]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=n,this.responseBody=s,this.isRetryable=l,this.data=u}static isInstance(e){return ed.hasMarker(e,eg)}static isAPICallError(e){return e instanceof Error&&e.name===ef&&"string"==typeof e.url&&"object"==typeof e.requestBodyValues&&(null==e.statusCode||"number"==typeof e.statusCode)&&(null==e.responseHeaders||"object"==typeof e.responseHeaders)&&(null==e.responseBody||"string"==typeof e.responseBody)&&(null==e.cause||"object"==typeof e.cause)&&"boolean"==typeof e.isRetryable&&(null==e.data||"object"==typeof e.data)}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};function eb(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}o=eh,Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError");var ev="AI_InvalidPromptError",ew=`vercel.ai.error.${ev}`,ex=Symbol.for(ew),e_=class extends ed{constructor({prompt:e,message:t,cause:r}){super({name:ev,message:`Invalid prompt: ${t}`,cause:r}),this[s]=!0,this.prompt=e}static isInstance(e){return ed.hasMarker(e,ew)}static isInvalidPromptError(e){return e instanceof Error&&e.name===ev&&null!=prompt}toJSON(){return{name:this.name,message:this.message,stack:this.stack,prompt:this.prompt}}};s=ex,Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var ek="AI_JSONParseError",eE=`vercel.ai.error.${ek}`,eI=Symbol.for(eE),eT=class extends ed{constructor({text:e,cause:t}){super({name:ek,message:`JSON parsing failed: Text: ${e}.
Error message: ${eb(t)}`,cause:t}),this[i]=!0,this.text=e}static isInstance(e){return ed.hasMarker(e,eE)}static isJSONParseError(e){return e instanceof Error&&e.name===ek&&"text"in e&&"string"==typeof e.text}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};i=eI,Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var eS="AI_TypeValidationError",eA=`vercel.ai.error.${eS}`,ej=Symbol.for(eA),ez=class e extends ed{constructor({value:e,cause:t}){super({name:eS,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${eb(t)}`,cause:t}),this[l]=!0,this.value=e}static isInstance(e){return ed.hasMarker(e,eA)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}static isTypeValidationError(e){return e instanceof Error&&e.name===eS}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};l=ej;var eN="AI_UnsupportedFunctionalityError",eC=`vercel.ai.error.${eN}`,eP=Symbol.for(eC),eO=class extends ed{constructor({functionality:e}){super({name:eN,message:`'${e}' functionality not supported.`}),this[u]=!0,this.functionality=e}static isInstance(e){return ed.hasMarker(e,eC)}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name===eN&&"string"==typeof e.functionality}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};function eR(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(eR):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&eR(t)))}u=eP;var e$=({prefix:e="",size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}={})=>{let a=M(r,t);return t=>`${e}${a(t)}`};function eM(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}e$();var eU=Symbol.for("vercel.ai.validator");function eq({value:e,schema:t}){let r="object"==typeof t&&null!==t&&eU in t&&!0===t[eU]&&"validate"in t?t:{[eU]:!0,validate:e=>{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}};try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:ez.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:ez.wrap({value:e,cause:t})}}}var{btoa:eL,atob:eZ}=globalThis;function eB(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return eL(t)}var eJ=r(69607);let eF=Symbol("Let zodToJsonSchema decide on which parser to use"),eD={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},eV=e=>"string"==typeof e?{...eD,name:e}:{...eD,...e},eH=e=>{let t=eV(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function eK(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function eG(e,t,r,a,n){e[t]=r,eK(e,t,a,n)}let eX=(e,t)=>tt(e.innerType._def,t),eW=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":eG(r,"minimum",a.value,a.message,t);break;case"max":eG(r,"maximum",a.value,a.message,t)}return r},eY=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,eQ={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===a&&(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function e0(e,t){let r={type:"string"};function a(e){return"escape"===t.patternStrategy?e1(e):e}if(e.checks)for(let n of e.checks)switch(n.kind){case"min":eG(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,n.value):n.value,n.message,t);break;case"max":eG(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"email":switch(t.emailStrategy){case"format:email":e2(r,"email",n.message,t);break;case"format:idn-email":e2(r,"idn-email",n.message,t);break;case"pattern:zod":e4(r,eQ.email,n.message,t)}break;case"url":e2(r,"uri",n.message,t);break;case"uuid":e2(r,"uuid",n.message,t);break;case"regex":e4(r,n.regex,n.message,t);break;case"cuid":e4(r,eQ.cuid,n.message,t);break;case"cuid2":e4(r,eQ.cuid2,n.message,t);break;case"startsWith":e4(r,RegExp(`^${a(n.value)}`),n.message,t);break;case"endsWith":e4(r,RegExp(`${a(n.value)}$`),n.message,t);break;case"datetime":e2(r,"date-time",n.message,t);break;case"date":e2(r,"date",n.message,t);break;case"time":e2(r,"time",n.message,t);break;case"duration":e2(r,"duration",n.message,t);break;case"length":eG(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,n.value):n.value,n.message,t),eG(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"includes":e4(r,RegExp(a(n.value)),n.message,t);break;case"ip":"v6"!==n.version&&e2(r,"ipv4",n.message,t),"v4"!==n.version&&e2(r,"ipv6",n.message,t);break;case"emoji":e4(r,eQ.emoji,n.message,t);break;case"ulid":e4(r,eQ.ulid,n.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":e2(r,"binary",n.message,t);break;case"contentEncoding:base64":eG(r,"contentEncoding","base64",n.message,t);break;case"pattern:zod":e4(r,eQ.base64,n.message,t)}break;case"nanoid":e4(r,eQ.nanoid,n.message,t)}return r}let e1=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),e2=(e,t,r,a)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):eG(e,"format",t,r,a)},e4=(e,t,r,a)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:e9(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):eG(e,"pattern",e9(t,a),r,a)},e9=(e,t)=>{let r="function"==typeof e?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;let a={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=a.i?r.source.toLowerCase():r.source,o="",s=!1,i=!1,l=!1;for(let e=0;e<n.length;e++){if(s){o+=n[e],s=!1;continue}if(a.i){if(i){if(n[e].match(/[a-z]/)){l?(o+=n[e]+`${n[e-2]}-${n[e]}`.toUpperCase(),l=!1):"-"===n[e+1]&&n[e+2]?.match(/[a-z]/)?(o+=n[e],l=!0):o+=`${n[e]}${n[e].toUpperCase()}`;continue}}else if(n[e].match(/[a-z]/)){o+=`[${n[e]}${n[e].toUpperCase()}]`;continue}}if(a.m){if("^"===n[e]){o+=`(^|(?<=[\r
]))`;continue}if("$"===n[e]){o+=`($|(?=[\r
]))`;continue}}if(a.s&&"."===n[e]){o+=i?`${n[e]}\r
`:`[${n[e]}\r
]`;continue}o+=n[e],"\\"===n[e]?s=!0:i&&"]"===n[e]?i=!1:i||"["!==n[e]||(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return o};function e8(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===X.pA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:tt(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:tt(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===X.pA.ZodString&&e.keyType._def.checks?.length){let a=Object.entries(e0(e.keyType._def,t)).reduce((e,[t,r])=>"type"===t?e:{...e,[t]:r},{});return{...r,propertyNames:a}}return e.keyType?._def.typeName===X.pA.ZodEnum?{...r,propertyNames:{enum:e.keyType._def.values}}:r}let e5={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},e3=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>tt(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},e6=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return tt(e.innerType._def,t);let r=tt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},e7=(e,t)=>{if("input"===t.pipeStrategy)return tt(e.in._def,t);if("output"===t.pipeStrategy)return tt(e.out._def,t);let r=tt(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=tt(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},te=(e,t)=>tt(e.innerType._def,t);function tt(e,t,r=!1){let a=t.seen.get(e);if(t.override){let n=t.override?.(e,t,a,r);if(n!==eF)return n}if(a&&!r){let e=tr(a,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let o=tn(e,e.typeName,t);return o&&to(e,t,o),n.jsonSchema=o,o}let tr=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:ta(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},ta=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},tn=(e,t,r)=>{switch(t){case X.pA.ZodString:return e0(e,r);case X.pA.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",eK(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?eG(r,"minimum",a.value,a.message,t):eG(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),eG(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?eG(r,"maximum",a.value,a.message,t):eG(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),eG(r,"maximum",a.value,a.message,t));break;case"multipleOf":eG(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case X.pA.ZodObject:return function(e,t){let r={type:"object",...Object.entries(e.shape()).reduce((e,[r,a])=>{if(void 0===a||void 0===a._def)return e;let n=tt(a._def,{...t,currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]});return void 0===n?e:{properties:{...e.properties,[r]:n},required:a.isOptional()?e.required:[...e.required,r]}},{properties:{},required:[]}),additionalProperties:"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:tt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:tt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0};return r.required.length||delete r.required,r}(e,r);case X.pA.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?eG(r,"minimum",a.value,a.message,t):eG(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),eG(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?eG(r,"maximum",a.value,a.message,t):eG(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),eG(r,"maximum",a.value,a.message,t));break;case"multipleOf":eG(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case X.pA.ZodBoolean:return{type:"boolean"};case X.pA.ZodDate:return function e(t,r,a){let n=a??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,n)=>e(t,r,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return eW(t,r)}}(e,r);case X.pA.ZodUndefined:return{not:{}};case X.pA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case X.pA.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def?.typeName!==X.pA.ZodAny&&(r.items=tt(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&eG(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&eG(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(eG(r,"minItems",e.exactLength.value,e.exactLength.message,t),eG(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case X.pA.ZodUnion:case X.pA.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return e3(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in e5&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=e5[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return e3(e,t)}(e,r);case X.pA.ZodIntersection:return function(e,t){let r=[tt(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),tt(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,n=[];return r.forEach(e=>{if(eY(e))n.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;n.push(t)}}),n.length?{allOf:n,...a}:void 0}(e,r);case X.pA.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>tt(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:tt(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>tt(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case X.pA.ZodRecord:return e8(e,r);case X.pA.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case X.pA.ZodEnum:return{type:"string",enum:e.values};case X.pA.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case X.pA.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:e5[e.innerType._def.typeName],nullable:!0}:{type:[e5[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=tt(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=tt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case X.pA.ZodOptional:return e6(e,r);case X.pA.ZodMap:return function(e,t){return"record"===t.mapStrategy?e8(e,t):{type:"array",maxItems:125,items:{type:"array",items:[tt(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},tt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case X.pA.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:tt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&eG(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&eG(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case X.pA.ZodLazy:return tt(e.getter()._def,r);case X.pA.ZodPromise:return tt(e.type._def,r);case X.pA.ZodNaN:case X.pA.ZodNever:return{not:{}};case X.pA.ZodEffects:return function(e,t){return"input"===t.effectStrategy?tt(e.schema._def,t):{}}(e,r);case X.pA.ZodAny:case X.pA.ZodUnknown:return{};case X.pA.ZodDefault:return function(e,t){return{...tt(e.innerType._def,t),default:e.defaultValue()}}(e,r);case X.pA.ZodBranded:return tt(e.type._def,r);case X.pA.ZodReadonly:return te(e,r);case X.pA.ZodCatch:return eX(e,r);case X.pA.ZodPipeline:return e7(e,r);case X.pA.ZodFunction:case X.pA.ZodVoid:case X.pA.ZodSymbol:default:return}},to=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),ts=(e,t)=>{let r=eH(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:tt(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,n="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,o=tt(e._def,void 0===n?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??{},s="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==s&&(o.title=s);let i=void 0===n?a?{...o,[r.definitionPath]:a}:o:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...a,[n]:o}};return"jsonSchema7"===r.target?i.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===r.target&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),i};var ti={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},tl={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},tu={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},tc={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},tp={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},tm={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},td={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},tf={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>null==e||"object"!=typeof e||!("id"in e)||"string"!=typeof e.id||!("type"in e)||"string"!=typeof e.type||!("function"in e)||null==e.function||"object"!=typeof e.function||!("arguments"in e.function)||"string"!=typeof e.function.name||"string"!=typeof e.function.arguments))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},tg={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},th={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},ty={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},tb={code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},tv={code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},tw={code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},tx={code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},t_=[ti,tl,tu,tc,tp,tm,td,tf,tg,th,ty,tb,tv,tw,tx],tk={[ti.code]:ti,[tl.code]:tl,[tu.code]:tu,[tc.code]:tc,[tp.code]:tp,[tm.code]:tm,[td.code]:td,[tf.code]:tf,[tg.code]:tg,[th.code]:th,[ty.code]:ty,[tb.code]:tb,[tv.code]:tv,[tw.code]:tw,[tx.code]:tx};ti.name,ti.code,tl.name,tl.code,tu.name,tu.code,tc.name,tc.code,tp.name,tp.code,tm.name,tm.code,td.name,td.code,tf.name,tf.code,tg.name,tg.code,th.name,th.code,ty.name,ty.code,tb.name,tb.code,tv.name,tv.code,tw.name,tw.code,tx.name,tx.code;var tE=t_.map(e=>e.code),tI=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!tE.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let a=JSON.parse(e.slice(t+1));return tk[r].parse(a)},tT=Symbol.for("vercel.ai.schema");function tS(e){return"object"==typeof e&&null!==e&&tT in e&&!0===e[tT]&&"jsonSchema"in e&&"validate"in e?e:function(e,{validate:t}={}){return{[tT]:!0,_type:void 0,[eU]:!0,jsonSchema:e,validate:t}}(ts(e),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var tA=Object.defineProperty,tj=(e,t)=>{for(var r in t)tA(e,r,{get:t[r],enumerable:!0})};async function tz(e){return void 0===e?Promise.resolve():new Promise(t=>setTimeout(t,e))}var tN="AI_RetryError",tC=`vercel.ai.error.${tN}`,tP=Symbol.for(tC),tO=class extends ed{constructor({message:e,reason:t,errors:r}){super({name:tN,message:e}),this[c]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return ed.hasMarker(e,tC)}static isRetryError(e){return e instanceof Error&&e.name===tN&&"string"==typeof e.reason&&Array.isArray(e.errors)}toJSON(){return{name:this.name,message:this.message,reason:this.reason,lastError:this.lastError,errors:this.errors}}};c=tP;var tR=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>t$(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function t$(e,{maxRetries:t,delayInMs:r,backoffFactor:a},n=[]){try{return await e()}catch(u){var o;if((o=u)instanceof Error&&("AbortError"===o.name||"TimeoutError"===o.name)||0===t)throw u;let s=eM(u),i=[...n,u],l=i.length;if(l>t)throw new tO({message:`Failed after ${l} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:i});if(u instanceof Error&&ey.isAPICallError(u)&&!0===u.isRetryable&&l<=t)return await tz(r),t$(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},i);if(1===l)throw u;throw new tO({message:`Failed after ${l} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:i})}}function tM({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}var tU={startSpan:()=>tq,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(tq):"function"==typeof r?r(tq):"function"==typeof a?a(tq):void 0},tq={spanContext:()=>tL,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},tL={traceId:"",spanId:"",traceFlags:0},tZ=void 0;function tB({name:e,tracer:t,attributes:r,fn:a,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return n&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:eJ.SpanStatusCode.ERROR,message:t.message})):e.setStatus({code:eJ.SpanStatusCode.ERROR})}finally{e.end()}throw t}})}function tJ({telemetry:e,attributes:t}){return Object.entries(t).reduce((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let n=a.input();return void 0===n?t:{...t,[r]:n}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let n=a.output();return void 0===n?t:{...t,[r]:n}}return{...t,[r]:a}},{})}var tF="AI_DownloadError",tD=`vercel.ai.error.${tF}`,tV=Symbol.for(tD),tH=class extends ed{constructor({url:e,statusCode:t,statusText:r,cause:a,message:n=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:tF,message:n,cause:a}),this[p]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return ed.hasMarker(e,tD)}static isDownloadError(e){return e instanceof Error&&e.name===tF&&"string"==typeof e.url&&(null==e.statusCode||"number"==typeof e.statusCode)&&(null==e.statusText||"string"==typeof e.statusText)}toJSON(){return{name:this.name,message:this.message,url:this.url,statusCode:this.statusCode,statusText:this.statusText,cause:this.cause}}};async function tK({url:e,fetchImplementation:t=fetch}){var r;let a=e.toString();try{let e=await t(a);if(!e.ok)throw new tH({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(r=e.headers.get("content-type"))?r:void 0}}catch(e){if(tH.isInstance(e))throw e;throw new tH({url:a,cause:e})}}p=tV;var tG=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}],tX="AI_InvalidDataContentError",tW=`vercel.ai.error.${tX}`,tY=Symbol.for(tW),tQ=class extends ed{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:tX,message:r,cause:t}),this[m]=!0,this.content=e}static isInstance(e){return ed.hasMarker(e,tW)}static isInvalidDataContentError(e){return e instanceof Error&&e.name===tX&&null!=e.content}toJSON(){return{name:this.name,message:this.message,stack:this.stack,cause:this.cause,content:this.content}}};m=tY;var t0=X.z.union([X.z.string(),X.z.instanceof(Uint8Array),X.z.instanceof(ArrayBuffer),X.z.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function t1(e){return"string"==typeof e?e:e instanceof ArrayBuffer?eB(new Uint8Array(e)):eB(e)}function t2(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return function(e){let t=eZ(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}(e)}catch(t){throw new tQ({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new tQ({content:e})}var t4="AI_InvalidMessageRoleError",t9=`vercel.ai.error.${t4}`,t8=Symbol.for(t9),t5=class extends ed{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:t4,message:t}),this[d]=!0,this.role=e}static isInstance(e){return ed.hasMarker(e,t9)}static isInvalidMessageRoleError(e){return e instanceof Error&&e.name===t4&&"string"==typeof e.role}toJSON(){return{name:this.name,message:this.message,stack:this.stack,role:this.role}}};function t3(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}async function t6({prompt:e,modelSupportsImageUrls:t=!0,downloadImplementation:r=tK}){let a=[];null!=e.system&&a.push({role:"system",content:e.system});let n=t||null==e.messages?null:await re(e.messages,r),o=e.type;switch(o){case"prompt":a.push({role:"user",content:[{type:"text",text:e.prompt}]});break;case"messages":a.push(...e.messages.map(e=>t7(e,n)));break;default:throw Error(`Unsupported prompt type: ${o}`)}return a}function t7(e,t){let r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerMetadata:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata};return{role:"user",content:e.content.map(r=>{var a,n,o,s,i;switch(r.type){case"text":return{type:"text",text:r.text,providerMetadata:r.experimental_providerMetadata};case"image":{if(r.image instanceof URL){if(null==t)return{type:"image",image:r.image,mimeType:r.mimeType,providerMetadata:r.experimental_providerMetadata};{let e=t[r.image.toString()];return{type:"image",image:e.data,mimeType:null!=(a=r.mimeType)?a:e.mimeType,providerMetadata:r.experimental_providerMetadata}}}if("string"==typeof r.image)try{let a=new URL(r.image);switch(a.protocol){case"http:":case"https:":if(null==t)return{type:"image",image:a,mimeType:r.mimeType,providerMetadata:r.experimental_providerMetadata};{let e=t[a.toString()];return{type:"image",image:e.data,mimeType:null!=(n=r.mimeType)?n:e.mimeType,providerMetadata:r.experimental_providerMetadata}}case"data:":try{let{mimeType:e,base64Content:t}=t3(r.image);if(null==e||null==t)throw Error("Invalid data URL format");return{type:"image",image:t2(t),mimeType:e,providerMetadata:r.experimental_providerMetadata}}catch(t){throw Error(`Error processing data URL: ${eM(e)}`)}}}catch(e){}let s=t2(r.image);return{type:"image",image:s,mimeType:null!=(o=r.mimeType)?o:function(e){for(let{bytes:t,mimeType:r}of tG)if(e.length>=t.length&&t.every((t,r)=>e[r]===t))return r}(s),providerMetadata:r.experimental_providerMetadata}}case"file":if(r.data instanceof URL){if(null==t)return{type:"file",data:r.data,mimeType:r.mimeType,providerMetadata:r.experimental_providerMetadata};{let e=t[r.data.toString()];return{type:"file",data:eB(e.data),mimeType:null!=(s=r.mimeType)?s:e.mimeType,providerMetadata:r.experimental_providerMetadata}}}if("string"==typeof r.data)try{let a=new URL(r.data);switch(a.protocol){case"http:":case"https:":if(null==t)return{type:"file",data:a,mimeType:r.mimeType,providerMetadata:r.experimental_providerMetadata};{let e=t[a.toString()];return{type:"file",data:eB(e.data),mimeType:null!=(i=r.mimeType)?i:e.mimeType,providerMetadata:r.experimental_providerMetadata}}case"data:":try{let{mimeType:e,base64Content:t}=t3(r.data);if(null==e||null==t)throw Error("Invalid data URL format");return{type:"file",data:t1(t),mimeType:e,providerMetadata:r.experimental_providerMetadata}}catch(t){throw Error(`Error processing data URL: ${eM(e)}`)}}}catch(e){}return{type:"file",data:t1(r.data),mimeType:r.mimeType,providerMetadata:r.experimental_providerMetadata}}}).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let{experimental_providerMetadata:t,...r}=e;return{...r,providerMetadata:t}}),providerMetadata:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,providerMetadata:e.experimental_providerMetadata})),providerMetadata:e.experimental_providerMetadata};default:throw new t5({role:r})}}async function re(e,t){let r=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL);return Object.fromEntries((await Promise.all(r.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}d=t8;var rt="AI_InvalidArgumentError",rr=`vercel.ai.error.${rt}`,ra=Symbol.for(rr),rn=class extends ed{constructor({parameter:e,value:t,message:r}){super({name:rt,message:`Invalid argument for parameter ${e}: ${r}`}),this[f]=!0,this.parameter=e,this.value=t}static isInstance(e){return ed.hasMarker(e,rr)}static isInvalidArgumentError(e){return e instanceof Error&&e.name===rt&&"string"==typeof e.parameter&&"string"==typeof e.value}toJSON(){return{name:this.name,message:this.message,stack:this.stack,parameter:this.parameter,value:this.value}}};f=ra;var ro=X.z.lazy(()=>X.z.union([X.z.null(),X.z.string(),X.z.number(),X.z.boolean(),X.z.record(X.z.string(),ro),X.z.array(ro)])),rs=X.z.record(X.z.string(),X.z.record(X.z.string(),ro)),ri=X.z.object({type:X.z.literal("text"),text:X.z.string(),experimental_providerMetadata:rs.optional()}),rl=X.z.object({type:X.z.literal("image"),image:X.z.union([t0,X.z.instanceof(URL)]),mimeType:X.z.string().optional(),experimental_providerMetadata:rs.optional()}),ru=X.z.object({type:X.z.literal("file"),data:X.z.union([t0,X.z.instanceof(URL)]),mimeType:X.z.string(),experimental_providerMetadata:rs.optional()}),rc=X.z.object({type:X.z.literal("tool-call"),toolCallId:X.z.string(),toolName:X.z.string(),args:X.z.unknown()}),rp=X.z.object({type:X.z.literal("tool-result"),toolCallId:X.z.string(),toolName:X.z.string(),result:X.z.unknown(),isError:X.z.boolean().optional(),experimental_providerMetadata:rs.optional()}),rm=X.z.object({role:X.z.literal("system"),content:X.z.string(),experimental_providerMetadata:rs.optional()}),rd=X.z.object({role:X.z.literal("user"),content:X.z.union([X.z.string(),X.z.array(X.z.union([ri,rl,ru]))]),experimental_providerMetadata:rs.optional()}),rf=X.z.object({role:X.z.literal("assistant"),content:X.z.union([X.z.string(),X.z.array(X.z.union([ri,rc]))]),experimental_providerMetadata:rs.optional()}),rg=X.z.object({role:X.z.literal("tool"),content:X.z.array(rp),experimental_providerMetadata:rs.optional()}),rh=X.z.union([rm,rd,rf,rg]);function ry(e,{contentType:t,dataStreamVersion:r}){var a;let n=new Headers(null!=(a=null==e?void 0:e.headers)?a:{});return n.has("Content-Type")||n.set("Content-Type",t),void 0!==r&&n.set("X-Vercel-AI-Data-Stream",r),n}var rb="AI_NoObjectGeneratedError",rv=`vercel.ai.error.${rb}`,rw=Symbol.for(rv),rx=class extends ed{constructor({message:e="No object generated."}={}){super({name:rb,message:e}),this[g]=!0}static isInstance(e){return ed.hasMarker(e,rv)}static isNoObjectGeneratedError(e){return e instanceof Error&&e.name===rb}toJSON(){return{name:this.name,cause:this.cause,message:this.message,stack:this.stack}}};g=rw;e$({prefix:"aiobj-",size:24});e$({prefix:"aiobj-",size:24});var r_="AI_InvalidToolArgumentsError",rk=`vercel.ai.error.${r_}`,rE=Symbol.for(rk),rI=class extends ed{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${eb(r)}`}){super({name:r_,message:a,cause:r}),this[h]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return ed.hasMarker(e,rk)}static isInvalidToolArgumentsError(e){return e instanceof Error&&e.name===r_&&"string"==typeof e.toolName&&"string"==typeof e.toolArgs}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,toolName:this.toolName,toolArgs:this.toolArgs}}};h=rE;var rT="AI_NoSuchToolError",rS=`vercel.ai.error.${rT}`,rA=Symbol.for(rS),rj=class extends ed{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:rT,message:r}),this[y]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return ed.hasMarker(e,rS)}static isNoSuchToolError(e){return e instanceof Error&&e.name===rT&&"toolName"in e&&void 0!=e.toolName&&"string"==typeof e.name}toJSON(){return{name:this.name,message:this.message,stack:this.stack,toolName:this.toolName,availableTools:this.availableTools}}};y=rA,Symbol.for("vercel.ai.error.AI_MessageConversionError");var rz=/^([\s\S]*?)(\s+)(\S*)$/;function rN({text:e="",toolCalls:t,toolResults:r}){let a=[];return a.push({role:"assistant",content:[{type:"text",text:e},...t]}),r.length>0&&a.push({role:"tool",content:r.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}))}),a}var rC=e$({prefix:"aitxt-",size:24});async function rP({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:o,maxRetries:s,abortSignal:i,headers:l,maxAutomaticRoundtrips:u=0,maxToolRoundtrips:c=u,maxSteps:p=null!=c?c+1:1,experimental_continuationSteps:m,experimental_continueSteps:d=null!=m&&m,experimental_telemetry:f,experimental_providerMetadata:g,_internal:{generateId:h=rC,currentDate:y=()=>new Date}={},onStepFinish:b,...v}){var w;if(p<1)throw new rn({parameter:"maxSteps",value:p,message:"maxSteps must be at least 1"});let x=function({model:e,settings:t,telemetry:r,headers:a}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(n=null==r?void 0:r.metadata)?n:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}({model:e,telemetry:f,headers:l,settings:{...v,maxRetries:s}}),_=function({isEnabled:e}){return e?tZ||eJ.trace.getTracer("ai"):tU}({isEnabled:null!=(w=null==f?void 0:f.isEnabled)&&w});return tB({name:"ai.generateText",attributes:tJ({telemetry:f,attributes:{...tM({operationId:"ai.generateText",telemetry:f}),...x,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:n,messages:o})},"ai.settings.maxSteps":p}}),tracer:_,fn:async u=>{var c,m,w,k,E,I;let T;let S=tR({maxRetries:s}),A=function(e){if(null==e.prompt&&null==e.messages)throw new e_({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new e_({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new e_({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new e_({prompt:e,message:"prompt must be a string"});return{type:"prompt",prompt:e.prompt,messages:void 0,system:e.system}}if(null!=e.messages){let t=eq({value:e.messages,schema:X.z.array(rh)});if(!t.success)throw new e_({prompt:e,message:"messages must be an array of CoreMessage",cause:t.error});return{type:"messages",prompt:void 0,messages:e.messages,system:e.system}}throw Error("unreachable")}({system:a,prompt:n,messages:o}),j={type:"regular",...function({tools:e,toolChoice:t}){return null!=e&&Object.keys(e).length>0?{tools:Object.entries(e).map(([e,t])=>({type:"function",name:e,description:t.description,parameters:tS(t.parameters).jsonSchema})),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:t,toolChoice:r})},z=function({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:o,stopSequences:s,seed:i,maxRetries:l}){if(null!=e){if(!Number.isInteger(e))throw new rn({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new rn({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new rn({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new rn({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new rn({parameter:"topK",value:a,message:"topK must be a number"});if(null!=n&&"number"!=typeof n)throw new rn({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(null!=o&&"number"!=typeof o)throw new rn({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new rn({parameter:"seed",value:i,message:"seed must be an integer"});if(null!=l){if(!Number.isInteger(l))throw new rn({parameter:"maxRetries",value:l,message:"maxRetries must be an integer"});if(l<0)throw new rn({parameter:"maxRetries",value:l,message:"maxRetries must be >= 0"})}return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:n,frequencyPenalty:o,stopSequences:null!=s&&s.length>0?s:void 0,seed:i,maxRetries:null!=l?l:2}}(v),N=await t6({prompt:A,modelSupportsImageUrls:e.supportsImageUrls}),C=[],P=[],O=0,R=[],$="",M=[],U={completionTokens:0,promptTokens:0,totalTokens:0},L="initial";do{let r=0===O?A.type:"messages";C=(null!=(c=(T=await S(()=>tB({name:"ai.generateText.doGenerate",attributes:tJ({telemetry:f,attributes:{...tM({operationId:"ai.generateText.doGenerate",telemetry:f}),...x,"ai.prompt.format":{input:()=>r},"ai.prompt.messages":{input:()=>JSON.stringify(N)},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":v.frequencyPenalty,"gen_ai.request.max_tokens":v.maxTokens,"gen_ai.request.presence_penalty":v.presencePenalty,"gen_ai.request.stop_sequences":v.stopSequences,"gen_ai.request.temperature":v.temperature,"gen_ai.request.top_k":v.topK,"gen_ai.request.top_p":v.topP}}),tracer:_,fn:async t=>{var a,n,o,s,u,c;let p=await e.doGenerate({mode:j,...z,inputFormat:r,prompt:N,providerMetadata:g,abortSignal:i,headers:l}),m={id:null!=(n=null==(a=p.response)?void 0:a.id)?n:h(),timestamp:null!=(s=null==(o=p.response)?void 0:o.timestamp)?s:y(),modelId:null!=(c=null==(u=p.response)?void 0:u.modelId)?c:e.modelId};return t.setAttributes(tJ({telemetry:f,attributes:{"ai.response.finishReason":p.finishReason,"ai.response.text":{output:()=>p.text},"ai.response.toolCalls":{output:()=>JSON.stringify(p.toolCalls)},"ai.response.id":m.id,"ai.response.model":m.modelId,"ai.response.timestamp":m.timestamp.toISOString(),"ai.usage.promptTokens":p.usage.promptTokens,"ai.usage.completionTokens":p.usage.completionTokens,"ai.finishReason":p.finishReason,"ai.result.text":{output:()=>p.text},"ai.result.toolCalls":{output:()=>JSON.stringify(p.toolCalls)},"gen_ai.response.finish_reasons":[p.finishReason],"gen_ai.response.id":m.id,"gen_ai.response.model":m.modelId,"gen_ai.usage.input_tokens":p.usage.promptTokens,"gen_ai.usage.output_tokens":p.usage.completionTokens}})),{...p,response:m}}}))).toolCalls)?c:[]).map(e=>(function({toolCall:e,tools:t}){let r=e.toolName;if(null==t)throw new rj({toolName:e.toolName});let a=t[r];if(null==a)throw new rj({toolName:e.toolName,availableTools:Object.keys(t)});let n=tS(a.parameters),o=""===e.args.trim()?eq({value:{},schema:n}):function({text:e,schema:t}){try{let r=q().parse(e);if(null==t)return{success:!0,value:r};return eq({value:r,schema:t})}catch(t){return{success:!1,error:eT.isJSONParseError(t)?t:new eT({text:e,cause:t})}}}({text:e.args,schema:n});if(!1===o.success)throw new rI({toolName:r,toolArgs:e.args,cause:o.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:o.value}})({toolCall:e,tools:t})),P=null==t?[]:await rO({toolCalls:C,tools:t,tracer:_,telemetry:f});let a={promptTokens:(I=T.usage).promptTokens,completionTokens:I.completionTokens,totalTokens:I.promptTokens+I.completionTokens};U.completionTokens+=a.completionTokens,U.promptTokens+=a.promptTokens,U.totalTokens+=a.totalTokens;let n="done";++O<p&&(d&&"length"===T.finishReason&&0===C.length?n="continue":C.length>0&&P.length===C.length&&(n="tool-result"));let o="continue"===n?function(e){let t=function(e){let t=e.match(rz);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}(e);return t?t.prefix+t.whitespace:e}(null!=(m=T.text)?m:""):null!=(w=T.text)?w:"";$="continue"===n||"continue"===L?$+o:o;let s={stepType:L,text:o,toolCalls:C,toolResults:P,finishReason:T.finishReason,usage:a,warnings:T.warnings,logprobs:T.logprobs,response:{...T.response,headers:null==(k=T.rawResponse)?void 0:k.headers},experimental_providerMetadata:T.providerMetadata,isContinued:"continue"===n};if(M.push(s),await (null==b?void 0:b(s)),"continue"===L){let e=R.pop();N.pop(),"string"==typeof e.content?e.content=$:e.content.push({text:o,type:"text"}),R.push(e),N.push(t7(e,null))}else if("continue"===n){let e=rN({text:$,toolCalls:C,toolResults:P});R.push(...e),N.push(...e.map(e=>t7(e,null)))}else{let e=rN({text:T.text,toolCalls:C,toolResults:P});R.push(...e),N.push(...e.map(e=>t7(e,null)))}L=n}while("done"!==L);return u.setAttributes(tJ({telemetry:f,attributes:{"ai.response.finishReason":T.finishReason,"ai.response.text":{output:()=>T.text},"ai.response.toolCalls":{output:()=>JSON.stringify(T.toolCalls)},"ai.usage.promptTokens":T.usage.promptTokens,"ai.usage.completionTokens":T.usage.completionTokens,"ai.finishReason":T.finishReason,"ai.result.text":{output:()=>T.text},"ai.result.toolCalls":{output:()=>JSON.stringify(T.toolCalls)}}})),new rR({text:$,toolCalls:C,toolResults:P,finishReason:T.finishReason,usage:U,warnings:T.warnings,response:{...T.response,headers:null==(E=T.rawResponse)?void 0:E.headers},logprobs:T.logprobs,responseMessages:R,steps:M,providerMetadata:T.providerMetadata})}})}async function rO({toolCalls:e,tools:t,tracer:r,telemetry:a}){return(await Promise.all(e.map(async e=>{let n=t[e.toolName];if((null==n?void 0:n.execute)==null)return;let o=await tB({name:"ai.toolCall",attributes:tJ({telemetry:a,attributes:{...tM({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":e.toolName,"ai.toolCall.id":e.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(e.args)}}}),tracer:r,fn:async t=>{let r=await n.execute(e.args);try{t.setAttributes(tJ({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return r}});return{toolCallId:e.toolCallId,toolName:e.toolName,args:e.args,result:o}}))).filter(e=>null!=e)}var rR=class{constructor(e){this.text=e.text,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.response=e.response,this.responseMessages=e.responseMessages,this.roundtrips=e.steps,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.rawResponse={headers:e.response.headers},this.logprobs=e.logprobs}};function r$(e,t){let r,a;let n=e.getReader(),o=t.getReader(),s=!1,i=!1;async function l(e){try{null==r&&(r=n.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==a&&(a=o.read());let t=await a;a=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(s){await u(e);return}if(i){await l(e);return}null==r&&(r=n.read()),null==a&&(a=o.read());let{result:t,reader:c}=await Promise.race([r.then(e=>({result:e,reader:n})),a.then(e=>({result:e,reader:o}))]);t.done||e.enqueue(t.value),c===n?(r=void 0,t.done&&(await u(e),s=!0)):(a=void 0,t.done&&(i=!0,await l(e)))}catch(t){e.error(t)}},cancel(){n.cancel(),o.cancel()}})}e$({prefix:"aitxt-",size:24});var rM="AI_NoSuchProviderError",rU=`vercel.ai.error.${rM}`;function rq(e){let t=new TextEncoder,r="",a=e||{};return new TransformStream({async start(){a.onStart&&await a.onStart()},async transform(e,n){let o="string"==typeof e?e:e.content;n.enqueue(t.encode(o)),r+=o,a.onToken&&await a.onToken(o),a.onText&&"string"==typeof e&&await a.onText(e)},async flush(){a.onCompletion&&await a.onCompletion(r),!a.onFinal||"experimental_onFunctionCall"in a||await a.onFinal(r)}})}v=Symbol.for(rU);function rL(){let e=new TextEncoder,t=new TextDecoder;return new TransformStream({transform:async(r,a)=>{let n=t.decode(r);a.enqueue(e.encode(function(e,t){let r=t_.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}("text",n)))}})}new TextDecoder("utf-8");function rZ(e,t){return rB(e,t)}function rB(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&rF(null==(r=e.data)?void 0:r.chunk,t);return}rF(e,t)}})).pipeThrough(rq(t)).pipeThrough(rL())}function rJ(e,t){var r;let a=rB(e,null==t?void 0:t.callbacks),n=null==t?void 0:t.data,o=null==t?void 0:t.init,s=n?r$(n.stream,a):a;return new Response(s,{status:null!=(r=null==o?void 0:o.status)?r:200,statusText:null==o?void 0:o.statusText,headers:ry(o,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function rF(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function rD(e,t){return(function(e){let t;let r=e[Symbol.asyncIterator](),a=(t=!0,e=>(t&&(e=e.trimStart())&&(t=!1),e));return new ReadableStream({async pull(e){var t;let{value:n,done:o}=await r.next();if(o){e.close();return}let s=a(null!=(t=n.delta)?t:"");s&&e.enqueue(s)}})})(e).pipeThrough(rq(t)).pipeThrough(rL())}function rV(e,t={}){var r;let{init:a,data:n,callbacks:o}=t,s=rD(e,o),i=n?r$(n.stream,s):s;return new Response(i,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:ry(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}tj({},{toAIStream:()=>rZ,toDataStream:()=>rB,toDataStreamResponse:()=>rJ}),tj({},{toDataStream:()=>rD,toDataStreamResponse:()=>rV});async function rH(e,t){let r;let{messages:a,namespaceId:n,vehicleArray:o}=await e.json();try{if(!n||!a)return new Response("Missing required fields",{status:400});r=await (0,T.Fh)(a,n,o)}catch(e){return console.error("Error fetching context:",e),new Response(JSON.stringify({message:"Failed to fetch context"}),{status:500})}if(r&&r.prompt&&r.prompt.length>0){let e=r.prompt[0].content,t=(await rP({system:e,temperature:.2,model:eu("gpt-4o"),maxRetries:2,messages:a})).text||"reelSearch AI is experiencing trouble. Please try again later";return I.Z.json(t,{status:200})}throw Error("Unexpected server response structure: 'prompt' array is missing or empty.")}Symbol("internal_openai_fn_messages"),(0,r(52443).h)([rH]),(0,E.U)("1c89eaf04d597c2fe34005b0c1f0085c165e9911",rH);let rK=new x.AppRouteRouteModule({definition:{kind:_.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/Users/morganfuller/Documents/Invoke/ReelSearch/temp/ReelSearch/app/api/chat/route.ts",nextConfigOutput:"",userland:w}),{requestAsyncStorage:rG,staticGenerationAsyncStorage:rX,serverHooks:rW,headerHooks:rY,staticGenerationBailout:rQ}=rK,r0="/api/chat/route";function r1(){return(0,k.patchFetch)({serverHooks:rW,staticGenerationAsyncStorage:rX})}},43268:(e,t,r)=>{r.d(t,{Fh:()=>_,dB:()=>w});var a=r(59152);r(42534);let n=require("firebase-admin");var o=r.n(n);async function s(){return function(e){let t=e.privateKey.replace(/\\n/g,"\n");if(o().apps.length>0)return o().app();let r=o().credential.cert({projectId:e.projectId,clientEmail:e.clientEmail,privateKey:t});return o().initializeApp({credential:r,projectId:e.projectId,storageBucket:e.storageBucket})}({projectId:process.env.projectId,clientEmail:process.env.client_email,storageBucket:process.env.storageBucket,privateKey:process.env.private_key})}var i=r(52443);async function l(e){try{let t=e?.id;console.log("id",t);let r=(await s()).firestore().collection("earnings").doc(String(e?.id));return await r.set(e,{merge:!0})}catch(e){throw console.log(e),Error(e)}}async function u(e){try{let t=await s();for(let r in e){let a=e[r];console.log("send obj",a);let n=t.firestore().collection("availability").doc(String(r));await n.set(a,{merge:!0})}return e}catch(e){throw console.log(e),Error(e)}}async function c(e){try{let t=(await s()).firestore().collection("availability").doc(e),r=await t.get(),a=await r.data();if(!a)throw Error("No data found");return a}catch(e){throw console.log(e),Error(e)}}async function p(e){try{let t=(await s()).firestore().collection("earnings").doc(e),r=await t.get(),a=await r.data();if(!a)throw Error("No data found");return a}catch(e){throw console.log(e),Error(e)}}async function m(e){try{let t=await s(),r=t.firestore().collection("fleets").doc();await r.set(e);let a=t.firestore().collection("users").doc(e.owner);return(await a.get()).data()?await a.update({fleets:n.firestore.FieldValue.arrayUnion(r.id)}):await t.firestore().collection("users").doc(e.owner).set({fleets:[r.id]}),{success:!0,message:"Fleet created successfully"}}catch(e){return console.log(e),{success:!1,message:e.message}}}async function d(e){try{let t=(await s()).firestore().collection("fleets").doc(e),r=await t.get(),a=await r.data();if(!a)throw Error("No data found");return a}catch(e){throw console.log(e),Error(e)}}let f=async e=>{try{let t=(await s()).firestore().collection("fleets").doc(e.id);return await t.set(e,{merge:!0})}catch(e){throw console.log(e),Error(e)}},g=async e=>{try{let t=(await s()).firestore().collection("fleets").doc(e);return await t.delete()}catch(e){throw console.log(e),Error(e)}},h=async e=>{try{console.log("joinFleet",e);let t=await s(),r=t.firestore().collection("fleets").doc(e.fleetId);await r.update({members:n.firestore.FieldValue.arrayUnion(e.userId)});let a=t.firestore().collection("users").doc(e.userId),o=(await a.get()).data();return console.log("userData",o),o?(console.log("user found"),await a.update({fleets:n.firestore.FieldValue.arrayUnion(e.fleetId)})):(console.log("user not found"),await t.firestore().collection("users").doc(e.userId).set({fleets:[e.fleetId]})),{success:!0,message:"Fleet joined successfully"}}catch(e){throw console.log(e),Error(e)}},y=async e=>{try{console.log("leaveFleet",e);let t=await s(),r=t.firestore().collection("fleets").doc(e.fleetId);await r.update({members:n.firestore.FieldValue.arrayRemove(e.userId)});let a=t.firestore().collection("users").doc(e.userId);return await a.update({fleets:n.firestore.FieldValue.arrayRemove(e.fleetId)}),{success:!0,message:"Fleet left successfully"}}catch(e){throw console.log(e),Error(e)}},b=async e=>{try{console.log("invitationToFleet",e);let t=await s(),r=t.firestore().collection("fleets").doc(e.fleetId),a=t.firestore().collection("users").doc(e.userId),o=(await a.get()).data();console.log("userData",o),o?await a.update({invitationSent:n.firestore.FieldValue.arrayUnion(e.fleetId),fleets:n.firestore.FieldValue.arrayUnion(e.fleetId)}):(console.log("user not found"),await t.firestore().collection("users").doc(e.userId).set({invitationSent:[e.fleetId]}));let i=await r.get(),l=await i.data(),u=r.collection("invitations").doc(),c={fleetId:e.fleetId,fleetName:l?.name,userId:e.userId,status:"pending"};return await u.set(c),{success:!0,message:"Fleet invitation sent successfully"}}catch(e){throw console.log(e),Error(e)}},v=async(e,t,r)=>{try{let r=(await s()).firestore().collection("_firestore-vector-search/index/queries"),a=await r.add({query:e,prefilters:[{field:"userID",operator:"==",value:t}]});if(!a.id){console.error("could not find DocIds");return}if(a.id){await new Promise(e=>setTimeout(e,2e3));let e=r.doc(a.id),t=(await e.get()).data();if(!t||void 0==t.result.ids)return console.error("refdocs do not exist"),"none";if(t.result.ids){let e=t.result.ids;return await x(e)}}}catch(e){return console.error("Error fetching documents:",e),"none"}},w=async(e,t,r)=>{try{let a=(await s()).firestore().collection("chatCollection");await k(t);let n=async(e,r)=>{try{let n=a.doc(r);return await n.set({input:e,userID:t}),n.id}catch(e){return console.error("Error adding document: ",e),null}},o=e.map((e,t)=>n(e,r[t]));return(await Promise.all(o)).filter(e=>null!==e)}catch(e){throw console.error("Error fetching documents:",e),e}},x=async e=>{try{let t=(await s()).firestore().collection("chatCollection"),r=async e=>{try{let r=t.doc(e),a=(await r.get()).data();if(a)return console.log("Document data:",a.input),a.input;return console.log("No such document!"),null}catch(e){return console.error("Error getting document:",e),null}},a=e.map(e=>r(e));return(await Promise.all(a)).filter(e=>null!==e)}catch(e){throw console.error("Error fetching documents:",e),e}};async function _(e,t,r){try{let a=e[e.length-1].content,n=await v(a,t,r);return{prompt:[{role:"system",content:`
        AI assistant is a brand new, powerful, human-like artificial intelligence. This Assistant is a skilled Turo Host and a skilled Data scientist.
        AI assistant will not apologize for previous responses, but instead will indicated new information was gained.
        keep responses between 10 and 50 words.

        Users will be asking question about car data provided on a data table. 
        If user asks about or refers to the current data or a data table or makes similar references, AI will refer to the the content after START CONTEXT BLOCK and before END OF CONTEXT BLOCK as the CONTEXT BLOCK. 
        AI assistant will take into account any CONTEXT BLOCK that is provided in a conversation.
        AI assistant will not invent anything that is not drawn directly from the context.
        AI assistant will double check makes,models, & years. AI assistant will not provide a response for cars that don't exist.
        AI assistant will not respond to any messages using markdown content, only basic text.

        START CONTEXT BLOCK
        ${n}
        END OF CONTEXT BLOCK

         
      `}]}}catch(e){throw e}}let k=async e=>{let t=(await s()).firestore().collection("chatCollection"),r=[];try{(await t.where("userID","==",e).get()).forEach(e=>{r.push(e.id)})}catch(e){console.log("Error getting documents: ",e);return}try{let e=r.map(e=>t.doc(e).delete());await Promise.all(e)}catch(e){console.log("Error deleting documents: ",e)}};(0,i.h)([l,u,c,p,m,d,f,g,h,y,b,w,_]),(0,a.U)("4853a2ad28150c6c59b936ed0f2f19c1c6340f6b",l),(0,a.U)("0f961e22418ec48f4008af9157a8b8a483a14c7d",u),(0,a.U)("b7228628164a4e821dea877d240c725307b4a598",c),(0,a.U)("6da32a183a858a33c4f91142cc210ea52394b6b5",p),(0,a.U)("fa9414a96eca9089053b25af36d45dadccf9d688",m),(0,a.U)("04c207ab9e56c7abf2d802e2ffe99f05a78be53d",d),(0,a.U)("27c7fb9c6a8868fa65f9682f29284af149df9e04",f),(0,a.U)("8c193a58f405ea3d858bc530bddb9c0c529d1a7e",g),(0,a.U)("589bbf0a687298caf910923eada890ca959ddffe",h),(0,a.U)("c203f8402ce38149781cd5297bdcb930fabacbc0",y),(0,a.U)("9b82dd5f6c76b92b1bd39bc37910be2fd72df137",b),(0,a.U)("95f552bc9a962411de563f0a75ba5074ea83d815",w),(0,a.U)("c368b1875dbb6e6f74b0bbee43f0b51469b990ba",_)},23012:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,o={};function s(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean);return`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}; ${r.join("; ")}`}function i(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[a,n]=[r.slice(0,e),r.slice(e+1)];try{t.set(a,decodeURIComponent(null!=n?n:"true"))}catch{}}return t}function l(e){var t,r;if(!e)return;let[[a,n],...o]=i(e),{domain:s,expires:l,httponly:p,maxage:m,path:d,samesite:f,secure:g,priority:h}=Object.fromEntries(o.map(([e,t])=>[e.toLowerCase(),t]));return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}({name:a,value:decodeURIComponent(n),domain:s,...l&&{expires:new Date(l)},...p&&{httpOnly:!0},..."string"==typeof m&&{maxAge:Number(m)},path:d,...f&&{sameSite:u.includes(t=(t=f).toLowerCase())?t:void 0},...g&&{secure:!0},...h&&{priority:c.includes(r=(r=h).toLowerCase())?r:void 0}})}((e,r)=>{for(var a in r)t(e,a,{get:r[a],enumerable:!0})})(o,{RequestCookies:()=>p,ResponseCookies:()=>m,parseCookie:()=>i,parseSetCookie:()=>l,stringifyCookie:()=>s}),e.exports=((e,o,s,i)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let s of a(o))n.call(e,s)||void 0===s||t(e,s,{get:()=>o[s],enumerable:!(i=r(o,s))||i.enumerable});return e})(t({},"__esModule",{value:!0}),o);var u=["strict","lax","none"],c=["low","medium","high"],p=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t)for(let[e,r]of i(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let a="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===a).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,a=this._parsed;return a.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(a).map(([e,t])=>s(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>s(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},m=class{constructor(e){var t,r,a;this._parsed=new Map,this._headers=e;let n=null!=(a=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?a:[];for(let e of Array.isArray(n)?n:function(e){if(!e)return[];var t,r,a,n,o,s=[],i=0;function l(){for(;i<e.length&&/\s/.test(e.charAt(i));)i+=1;return i<e.length}for(;i<e.length;){for(t=i,o=!1;l();)if(","===(r=e.charAt(i))){for(a=i,i+=1,l(),n=i;i<e.length&&"="!==(r=e.charAt(i))&&";"!==r&&","!==r;)i+=1;i<e.length&&"="===e.charAt(i)?(o=!0,i=n,s.push(e.substring(t,a)),t=i):i=a+1}else i+=1;(!o||i>=e.length)&&s.push(e.substring(t,e.length))}return s}(n)){let t=l(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let a="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===a)}has(e){return this._parsed.has(e)}set(...e){let[t,r,a]=1===e.length?[e[0].name,e[0].value,e[0]]:e,n=this._parsed;return n.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...a})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=s(r);t.append("set-cookie",e)}}(n,this._headers),this}delete(...e){let[t,r,a]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:r,domain:a,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(s).join("; ")}}},21482:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RequestCookies:function(){return a.RequestCookies},ResponseCookies:function(){return a.ResponseCookies}});let a=r(23012)},16428:e=>{let t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function n(e,n,s){null==s&&null!==n&&"object"==typeof n&&(s=n,n=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let i=JSON.parse(e,n);if(null===i||"object"!=typeof i)return i;let l=s&&s.protoAction||"error",u=s&&s.constructorAction||"error";if("ignore"===l&&"ignore"===u)return i;if("ignore"!==l&&"ignore"!==u){if(!1===r.test(e)&&!1===a.test(e))return i}else if("ignore"!==l&&"ignore"===u){if(!1===r.test(e))return i}else if(!1===a.test(e))return i;return o(i,{protoAction:l,constructorAction:u,safe:s&&s.safe})}function o(e,{protoAction:t="error",constructorAction:r="error",safe:a}={}){let n=[e];for(;n.length;){let e=n;for(let o of(n=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(o,"__proto__")){if(!0===a)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete o.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(o,"constructor")&&Object.prototype.hasOwnProperty.call(o.constructor,"prototype")){if(!0===a)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete o.constructor}for(let e in o){let t=o[e];t&&"object"==typeof t&&n.push(t)}}}return e}function s(e,t,r){let a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,r)}finally{Error.stackTraceLimit=a}}e.exports=s,e.exports.default=s,e.exports.parse=s,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=o}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[5046,4132,5878],()=>r(50044));module.exports=a})();