"use strict";(()=>{var e={};e.id=3847,e.ids=[3847],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},28362:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>m,originalPathname:()=>O,patchFetch:()=>d,requestAsyncStorage:()=>R,routeModule:()=>u,serverHooks:()=>l,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>T});var n={};s.r(n),s.d(n,{GET:()=>c});var t=s(26040),i=s(7623),E=s(52816),_=s(41912),o=s(44132),a=s(75409),p=s(78827);async function c(e){try{let e=await (0,_.getServerSession)(a.L);if(!e?.user||!e?.user.email)return new Response(null,{status:403});let r=await (0,p.b)(e.user.id);return new Response(JSON.stringify({...e,plan:r}),{status:200})}catch(e){if(e instanceof o.z.ZodError)return new Response(JSON.stringify(e.issues),{status:422});return new Response(null,{status:500})}}(0,s(38055).G)("/dashboard/billing");let u=new t.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/users/me/route",pathname:"/api/users/me",filename:"route",bundlePath:"app/api/users/me/route"},resolvedPagePath:"/Users/morganfuller/Documents/Invoke/ReelSearch/temp/ReelSearch/app/api/users/me/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:R,staticGenerationAsyncStorage:I,serverHooks:l,headerHooks:m,staticGenerationBailout:T}=u,O="/api/users/me/route";function d(){return(0,E.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:I})}},85685:(e,r,s)=>{s.d(r,{H:()=>i,R:()=>t});var n=s(47980);let t={name:"Free",description:"The free plan has limited features to view daily vehicle pricing data.",stripePriceId:""},i={name:"PRO",description:"PRO plan: Advanced data vizualization, revenue and market analysis, plus reelSearch+ChatGPT",stripePriceId:n.O.STRIPE_PRO_MONTHLY_PLAN_ID||""}},47980:(e,r,s)=>{s.d(r,{O:()=>i});var n=s(7487),t=s(44132);let i=(0,n.D)({server:{apiKey:t.z.string().min(1),appId:t.z.string().min(1),auth_provider_x509_cert_url:t.z.string().min(1),auth_uri:t.z.string().min(1),authDomain:t.z.string().min(1),client_email:t.z.string().min(1),client_id:t.z.string().min(1),client_x509_cert_url:t.z.string().min(1),DATABASE_URL:t.z.string().min(1),GOOGLE_CLIENT_ID:t.z.string().min(1),GOOGLE_CLIENT_SECRET:t.z.string().min(1),measurementId:t.z.string().min(1),messagingSenderId:t.z.string().min(1),NEXT_PUBLIC_APP_URL:t.z.string().min(1),NEXT_PUBLIC_FACEBOOK_PIXEL_ID:t.z.string().min(1),NEXTAUTH_SECRET:t.z.string().min(1),NEXTAUTH_URL:t.z.string().url().optional(),OPENAI_API_KEY:t.z.string().min(1),OPENAI_ORG_ID:t.z.string().min(1),PINECONE_KEY:t.z.string().min(1),private_key:t.z.string().min(1),private_key_id:t.z.string().min(1),FACEBOOKCONVTOKEN:t.z.string().min(1),projectId:t.z.string().min(1),storageBucket:t.z.string().min(1),STRIPE_API_KEY:t.z.string().min(1),STRIPE_PRO_MONTHLY_PLAN_ID:t.z.string().min(1),STRIPE_WEBHOOK_SECRET:t.z.string().min(1),token_uri:t.z.string().min(1),type:t.z.string().min(1),universe_domain:t.z.string().min(1),EMAIL_SERVER_USER:t.z.string().min(1),EMAIL_SERVER_PASSWORD:t.z.string().min(1),EMAIL_SERVER_HOST:t.z.string().min(1),EMAIL_SERVER_PORT:t.z.string().min(1),EMAIL_FROM:t.z.string().min(1)},client:{NEXT_PUBLIC_APP_URL:t.z.string().min(1)},runtimeEnv:{apiKey:process.env.apiKey,appId:process.env.appId,auth_provider_x509_cert_url:process.env.auth_provider_x509_cert_url,auth_uri:process.env.auth_uri,authDomain:process.env.authDomain,client_email:process.env.client_email,client_id:process.env.client_id,client_x509_cert_url:process.env.client_x509_cert_url,DATABASE_URL:process.env.DATABASE_URL,GOOGLE_CLIENT_ID:process.env.GOOGLE_CLIENT_ID,GOOGLE_CLIENT_SECRET:process.env.GOOGLE_CLIENT_SECRET,measurementId:process.env.measurementId,messagingSenderId:process.env.messagingSenderId,NEXT_PUBLIC_APP_URL:"http://localhost:3000",NEXT_PUBLIC_FACEBOOK_PIXEL_ID:"877663831030809",NEXTAUTH_SECRET:process.env.NEXTAUTH_SECRET,NEXTAUTH_URL:process.env.NEXTAUTH_URL,OPENAI_API_KEY:process.env.OPENAI_API_KEY,OPENAI_ORG_ID:process.env.OPENAI_ORG_ID,PINECONE_KEY:process.env.PINECONE_KEY,private_key:process.env.private_key,private_key_id:process.env.FACEBOOKCONVTOKEN,FACEBOOKCONVTOKEN:process.env.PINECONE_KEY,projectId:process.env.projectId,storageBucket:process.env.storageBucket,STRIPE_API_KEY:process.env.STRIPE_API_KEY,STRIPE_PRO_MONTHLY_PLAN_ID:process.env.STRIPE_PRO_MONTHLY_PLAN_ID,STRIPE_WEBHOOK_SECRET:process.env.STRIPE_WEBHOOK_SECRET,token_uri:process.env.token_uri,type:process.env.type,universe_domain:process.env.universe_domain,NEXTAUTH_URL:process.env.NEXTAUTH_URL,NEXTAUTH_SECRET:process.env.NEXTAUTH_SECRET,DATABASE_URL:process.env.DATABASE_URL,STRIPE_API_KEY:process.env.STRIPE_API_KEY,STRIPE_WEBHOOK_SECRET:process.env.STRIPE_WEBHOOK_SECRET,STRIPE_PRO_MONTHLY_PLAN_ID:process.env.STRIPE_PRO_MONTHLY_PLAN_ID,NEXT_PUBLIC_APP_URL:"http://localhost:3000",GOOGLE_CLIENT_ID:process.env.GOOGLE_CLIENT_ID,GOOGLE_CLIENT_SECRET:process.env.GOOGLE_CLIENT_SECRET,NEXT_PUBLIC_FACEBOOK_PIXEL_ID:"877663831030809",EMAIL_SERVER_USER:process.env.EMAIL_SERVER_USER,EMAIL_SERVER_PASSWORD:process.env.EMAIL_SERVER_PASSWORD,EMAIL_SERVER_HOST:process.env.EMAIL_SERVER_PASSWORD,EMAIL_SERVER_PORT:process.env.EMAIL_SERVER_PASSWORD,EMAIL_FROM:process.env.EMAIL_SERVER_PASSWORD}})},75409:(e,r,s)=>{s.d(r,{L:()=>a});var n=s(5100),t=s(60318),i=s(18110),E=s(54124),_=s(47980),o=s(84808);(0,E.createTransport)({host:process.env.EMAIL_SERVER_HOST,port:process.env.EMAIL_SERVER_PORT,secure:!0,auth:{user:process.env.EMAIL_SERVER_USER,pass:process.env.EMAIL_SERVER_PASSWORD}});let a={adapter:(0,n.N)(o.db),session:{strategy:"jwt"},pages:{signIn:"/login"},providers:[(0,i.Z)({clientId:_.O.GOOGLE_CLIENT_ID,clientSecret:_.O.GOOGLE_CLIENT_SECRET,allowDangerousEmailAccountLinking:!0}),(0,t.Z)({server:{host:process.env.EMAIL_SERVER_HOST,port:process.env.EMAIL_SERVER_PORT,auth:{user:process.env.EMAIL_SERVER_USER,pass:process.env.EMAIL_SERVER_PASSWORD}},from:process.env.EMAIL_FROM,sendVerificationRequest:async({identifier:e,url:r,provider:s})=>{let{server:n,from:t}=s,i=(0,E.createTransport)(n),_={to:e,from:t,subject:`Sign in to ${process.env.NEXTAUTH_URL}`,text:`Sign in to ${process.env.NEXTAUTH_URL}
${r}

`,html:`<p>Sign in to <strong>${process.env.NEXTAUTH_URL}</strong></p><p><a href="${r}">Click here to sign in</a></p>`};await i.sendMail(_)}})],callbacks:{session:async({token:e,session:r})=>(e&&(r.user.id=e.id,r.user.name=e.name,r.user.email=e.email,r.user.image=e.picture,r.user.fleetMemberships=e.fleetMemberships),r),async jwt({token:e,user:r}){let s=await o.db.user.findFirst({where:{email:e.email},include:{fleetMemberships:{select:{id:!0,fleet:{select:{name:!0,id:!0}}}}}});return s?{id:s.id,name:s.name,email:s.email,picture:s.image,fleetMemberships:s.fleetMemberships}:(r&&(e.id=r?.id),e)}}}},84808:(e,r,s)=>{s.d(r,{db:()=>n});let n=new(s(53524)).PrismaClient},78827:(e,r,s)=>{s.d(r,{b:()=>i});var n=s(85685),t=s(84808);async function i(e){let r=await t.db.user.findFirst({where:{id:e},select:{stripeSubscriptionId:!0,stripeCurrentPeriodEnd:!0,stripeCustomerId:!0,stripePriceId:!0}});if(!r)throw Error("User not found");let s=r.stripePriceId&&r.stripeCurrentPeriodEnd?.getTime()+864e5>Date.now();return{...s?n.H:n.R,...r,stripeCurrentPeriodEnd:r.stripeCurrentPeriodEnd?.getTime(),isPro:s}}},38055:(e,r,s)=>{s.d(r,{G:()=>o,cn:()=>E,p:()=>_});var n=s(61611),t=s(94021),i=s(47980);function E(...e){return(0,t.m)((0,n.W)(e))}function _(e){return new Date(e).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}function o(e){return`${i.O.NEXT_PUBLIC_APP_URL}${e}`}},26040:(e,r,s)=>{e.exports=s(30517)}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),n=r.X(0,[5046,4132,863,3613,4539],()=>s(28362));module.exports=n})();